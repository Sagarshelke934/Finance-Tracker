{% extends 'base.html' %}
{% load static %}

{% block title %}EMI Calculator - FinTrack{% endblock %}

{% block content %}
<div class="ledger-container" style="max-width: 800px;">
    <!-- Header -->
    <div class="ledger-header"
        style="justify-content: center; text-align: center; flex-direction: column; align-items: center;">
        <div class="ledger-title">
            <h1 class="animate-fade-in"><i class="fa-solid fa-calculator" style="color: var(--accent-blue);"></i> EMI
                Calculator</h1>
            <div class="ledger-subtitle animate-fade-in animate-delay-1">Plan your loans with precision</div>
        </div>
    </div>

    <div class="card-hub animate-fade-in animate-delay-2" style="padding: 32px; margin-top: 20px;">
        <form method="post" style="display: grid; gap: 24px;">
            {% csrf_token %}

            <div class="form-grid"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px;">
                <div class="form-group">
                    <label
                        style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-secondary);">Principal
                        Amount (₹)</label>
                    <input type="number" id="id_principal" name="principal" value="{{ principal|default:'' }}"
                        class="form-control-clean" placeholder="e.g. 5000000" required>
                </div>

                <div class="form-group">
                    <label
                        style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-secondary);">Interest
                        Rate (% p.a)</label>
                    <input type="number" step="0.1" id="id_rate" name="rate" value="{{ rate|default:'' }}"
                        class="form-control-clean" placeholder="e.g. 8.5" required>
                </div>

                <div class="form-group">
                    <label
                        style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-secondary);">Tenure
                        (Years)</label>
                    <input type="number" id="id_tenure" name="tenure" value="{{ tenure|default:'' }}"
                        class="form-control-clean" placeholder="e.g. 20" required>
                </div>
            </div>

            <button type="button" onclick="calculateEMI()" class="btn-primary-new"
                style="justify-content: center; padding: 14px; font-size: 1rem; margin-top: 10px;">
                Calculate EMI
            </button>
        </form>

        <div id="result-box" class="result-box animate-fade-in"
            style="margin-top: 32px; padding: 24px; background: var(--bg-body); border-radius: 16px; border: 1px solid var(--border-light); display: none;">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 4px;">Monthly EMI</div>
                <div style="font-size: 2.5rem; font-weight: 800; color: var(--accent-blue);">₹<span
                        id="out_emi">0</span></div>
            </div>

            <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; border-top: 1px solid var(--border-light); padding-top: 24px;">
                <div style="text-align: center;">
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Total Interest</div>
                    <div style="font-size: 1.1rem; font-weight: 700; color: var(--accent-coral);">₹<span
                            id="out_interest">0</span></div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Total Payment</div>
                    <div style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">₹<span
                            id="out_total">0</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control-clean {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border-light);
        border-radius: 12px;
        background: var(--bg-body);
        color: var(--text-main);
        font-size: 1rem;
        transition: all 0.2s;
    }

    .form-control-clean:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px var(--accent-blue-subtle);
    }
</style>

<script>
    function calculateEMI() {
        // 1. Get Inputs
        const P = parseFloat(document.getElementById('id_principal').value);
        const R_annual = parseFloat(document.getElementById('id_rate').value);
        const N_years = parseFloat(document.getElementById('id_tenure').value);

        if (!P || !R_annual || !N_years) {
            alert("Please fill all fields correctly");
            return;
        }

        // 2. Logic: EMI = [P x R x (1+R)^N]/[(1+R)^N-1]
        const r = (R_annual / 12) / 100; // Monthly Rate
        const n = N_years * 12; // Months

        const emi = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        const totalPayment = emi * n;
        const totalInterest = totalPayment - P;

        // 3. Update UI
        document.getElementById('out_emi').innerText = Math.round(emi).toLocaleString('en-IN');
        document.getElementById('out_interest').innerText = Math.round(totalInterest).toLocaleString('en-IN');
        document.getElementById('out_total').innerText = Math.round(totalPayment).toLocaleString('en-IN');

        document.getElementById('result-box').style.display = 'block';
    }
</script>
{% endblock %}